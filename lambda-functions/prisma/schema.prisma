generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  name           String
  email          String          @unique
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ApiKey         ApiKey[]
  Media          Media[]
  Post           Post[]
  SocialAccounts SocialAccount[]
}

model ApiKey {
  id String @id @default(cuid())

  key    String @unique
  secret String

  name        String
  description String?

  userId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Media {
  id        String      @id @default(cuid())
  type      MediaType
  format    MediaFormat
  size      BigInt
  url       String //Url to access the image from the s3.
  name      String //Name to display to USER not a UNIQUE NAME used in the storage bucket 
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  Post      Post[]      @relation("MediaToPost")
}

enum MediaType {
  IMAGE
  VIDEO
}

enum MediaFormat {
  // image formats 
  JPEG
  PNG

  // Video
  MP4
  MOV
  MKV
}

model SocialAccount {
  id             String            @id @default(cuid())
  userId         String
  type           SocialAccountType
  username       String
  profilePicture String?

  error  String?
  paused Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User   @relation(fields: [userId], references: [id])
  posts Post[] @relation("PostToSocialAccount")

  XAccount        XAccount?
  LinkedInAccount LinkedInAccount?
}

model LinkedInAccount {
  id String @id @default(uuid())

  // Creds or details needed for the posting 
  accessToken     String
  refreshToken    String?
  uuid            String // uuid refers to linkedin uuid 
  lastRefreshedAt DateTime

  socialAccountId String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
}

model XAccount {
  id String @id @default(uuid())

  // Creds or details needed for the posting 
  accessToken       String
  accessSecretToken String

  socialAccountId String @unique

  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  lastRefreshedAt DateTime
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Post {
  id            String          @id @default(cuid())
  text          String
  userId        String
  scheduledAt   DateTime        @default(now())
  postedAt      DateTime        @default(now())
  status        PostStatus      @default(SCHEDULED)
  draft         Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  error         String?
  user          User            @relation(fields: [userId], references: [id])
  media         Media[]         @relation("MediaToPost")
  socialAccount SocialAccount[] @relation("PostToSocialAccount")
  scheduleId    String?
}

enum PostStatus {
  SCHEDULED
  POSTED
  FAILED
}

enum SocialAccountType {
  INSTAGRAM
  X
  LINKEDIN
}

model S3PreSignedUrl {
  id          String @id @default(uuid())
  uuid        String @unique
  signedUrl   String
  name        String
  pathKey     String
  contentType String
  publicUrl   String
  type        String
  size        BigInt

  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
